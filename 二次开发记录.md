# cuscli 二次开发记录

本文档记录 cuscli 项目的二次开发过程，包括每次修改的背景、方案和结果。

---

## 2025-10-13: 修复删除 token_helper 插件后的导入错误

### 问题描述

删除 `token_helper` 插件后，启动 `cuscli` 时出现以下错误：

```
ModuleNotFoundError: No module named 'autocoder.common.international.messages.token_helper_plugin_messages'
```

错误堆栈显示：
- 入口点：`/usr/local/bin/cuscli`
- 导入链：`chat_auto_coder.py` → `conf_command.py` → `conf_validator.py` → `utils/__init__.py` → `action_yml_file_manager.py` → `printer.py` → `auto_coder_lang.py` → `international/__init__.py` → `messages/__init__.py`
- 失败点：`messages/__init__.py` 尝试导入已删除的 `token_helper_plugin_messages` 模块

### 根本原因

虽然 `token_helper_plugin_messages.py` 文件已被删除，但 `autocoder/common/international/messages/__init__.py` 文件中仍保留对该模块的引用：
1. 第12行：导入语句
2. 第27行：消息注册调用
3. 第42行：`__all__` 列表中的导出声明

### 解决方案

从 `autocoder/common/international/messages/__init__.py` 中移除所有对 `token_helper_plugin_messages` 的引用：

**修改文件**：`autocoder/common/international/messages/__init__.py`

**修改内容**：
1. 删除导入语句：
   ```python
   # 删除此行
   from .token_helper_plugin_messages import TOKEN_HELPER_PLUGIN_MESSAGES
   ```

2. 删除注册调用：
   ```python
   # 删除此行
   register_messages(TOKEN_HELPER_PLUGIN_MESSAGES)
   ```

3. 删除导出声明：
   ```python
   # 从 __all__ 列表中删除
   'TOKEN_HELPER_PLUGIN_MESSAGES',
   ```

### 验证结果

修复后测试启动命令：
```bash
$ cuscli --help
usage: cuscli [-h] [--debug] [--quick] [--skip_provider_selection]
              [--product_mode PRODUCT_MODE] [--lite] [--pro]

Chat Auto Coder
...
```

✅ 导入错误已修复，`cuscli` 命令可以正常显示帮助信息。

### 相关文件

- 修改文件：`autocoder/common/international/messages/__init__.py`
- 已删除插件：`autocoder/plugins/token_helper_plugin.py`
- 已删除消息文件：`autocoder/common/international/messages/token_helper_plugin_messages.py`

### 相关 commit

- 提交哈希：（待提交）
- 提交信息：fix: 修复删除 token_helper 插件后的导入错误

---
