# 工具交互提示词

## 概述

工具交互提示词使 autocoder 能够与外部系统和服务进行交互，扩展其能力范围。这些提示词定义了如何使用 RAG、Web 搜索、TODO 管理、MCP 工具等功能。

## 1. RAG（检索增强生成）工具

### 文件位置
- `autocoder/rag/agentic_rag.py`
- `autocoder/rag/tools/recall_tool.py`

### 核心功能

#### Recall Tool
从知识库中检索相关信息

**使用场景**：
- 查找项目文档
- 检索历史对话
- 获取领域知识

### Agentic RAG

**文件位置**：`autocoder/rag/agentic_rag.py`

**特点**：
- 智能查询重写
- 多轮检索
- 结果融合

**提示词模式**：
```python
@byzerllm.prompt()
def rewrite_query(self, original_query: str, context: str) -> str:
    """
    根据上下文重写查询，使其更适合检索。

    原始查询：{{ original_query }}
    上下文：{{ context }}

    请生成一个更精确的检索查询。
    """
```

## 2. Web 搜索工具

### 文件位置
`autocoder/rag/tools/web_search_tool.py`

### 功能
- 搜索最新信息
- 查找技术文档
- 获取实时数据

### 提示词设计

```python
@byzerllm.prompt()
def search_web(self, query: str) -> str:
    """
    使用搜索引擎查找相关信息。

    搜索查询：{{ query }}

    注意：
    1. 评估搜索结果的可靠性
    2. 提取关键信息
    3. 引用来源
    """
```

## 3. Web 爬虫工具

### 文件位置
`autocoder/rag/tools/web_crawl_tool.py`

### 功能
- 抓取网页内容
- 提取结构化信息
- 处理动态内容

### 提示词模式

```python
@byzerllm.prompt()
def extract_content(self, html: str, target: str) -> str:
    """
    从HTML中提取目标信息。

    目标：{{ target }}

    HTML 内容：
    {{ html }}

    请提取并整理相关信息。
    """
```

## 4. TODO 管理工具

### 文件位置
- `autocoder/rag/tools/todo_read_tool.py`
- `autocoder/rag/tools/todo_write_tool.py`

### 功能

#### TODO 读取
```python
@byzerllm.prompt()
def read_todos(self) -> str:
    """
    读取并分析当前的 TODO 列表。

    请按优先级和类别整理 TODO 项目。
    """
```

#### TODO 写入
```python
@byzerllm.prompt()
def write_todo(self, task: str, priority: str) -> str:
    """
    创建新的 TODO 项目。

    任务：{{ task }}
    优先级：{{ priority }}

    请生成结构化的 TODO 条目。
    """
```

## 5. MCP (Model Context Protocol) 工具

### 文件位置
`autocoder/common/mcp_tools/executor.py`

### 功能
- 集成第三方工具
- 扩展 Agent 能力
- 统一工具接口

### 提示词模式

```python
@byzerllm.prompt()
def use_mcp_tool(self, tool_name: str, params: dict) -> str:
    """
    使用 MCP 工具执行任务。

    工具名称：{{ tool_name }}
    参数：{{ params }}

    请调用工具并处理结果。
    """
```

## 6. 项目结构工具

### 文件位置
`autocoder/utils/project_structure.py`

### 功能
- 分析项目结构
- 识别项目类型
- 生成结构摘要

### 提示词示例

```python
@byzerllm.prompt()
def analyze_structure(self, files: list) -> str:
    """
    分析项目结构。

    文件列表：
    {% for file in files %}
    - {{ file }}
    {% endfor %}

    请识别：
    1. 项目类型（web、CLI、库等）
    2. 技术栈
    3. 目录组织模式
    4. 主要模块
    """
```

## 7. 代码搜索工具

### 文件位置
- `autocoder/common/search.py`
- 各种 search_files 工具

### 功能
- 正则表达式搜索
- 语义搜索
- 符号搜索

### 提示词模式

```python
@byzerllm.prompt()
def construct_search_pattern(self, intent: str) -> str:
    """
    根据搜索意图构造正则表达式。

    意图：{{ intent }}

    请生成合适的正则表达式模式。
    考虑：
    - 变量命名约定
    - 代码风格
    - 语言特性
    """
```

## 8. 命令生成工具

### 文件位置
`autocoder/common/command_generator.py`

### 功能
- 生成 shell 命令
- 适配不同操作系统
- 处理特殊字符

### 提示词示例

```python
@byzerllm.prompt()
def generate_command(self, task: str, os: str) -> str:
    """
    生成执行任务的命令。

    任务：{{ task }}
    操作系统：{{ os }}

    请生成：
    1. 命令字符串
    2. 参数说明
    3. 注意事项
    4. 预期输出
    """
```

## 工具集成模式

### 1. 工具链模式
多个工具顺序执行：
```
搜索 -> 读取 -> 分析 -> 生成 -> 验证
```

### 2. 工具编排模式
根据条件选择工具：
```python
if need_web_info:
    use web_search
elif need_local_info:
    use rag_search
else:
    use file_search
```

### 3. 工具组合模式
并行使用多个工具：
```
并行 {
    web_search
    rag_search
    file_search
}
融合结果
```

## 提示词设计原则

### 1. 清晰的输入输出
```python
"""
输入：{{ input_description }}
输出：{{ output_description }}
格式：{{ format_specification }}
"""
```

### 2. 错误处理指导
```python
"""
如果遇到以下情况：
- 网络错误：{{ fallback_strategy }}
- 格式错误：{{ validation_rules }}
- 权限错误：{{ permission_handling }}
"""
```

### 3. 结果验证
```python
"""
验证检查：
1. 结果完整性
2. 格式正确性
3. 内容相关性
"""
```

## 使用场景总结

| 工具 | 使用场景 | 输入 | 输出 |
|-----|---------|------|-----|
| RAG | 检索知识 | 查询文本 | 相关文档 |
| Web Search | 获取最新信息 | 搜索关键词 | 搜索结果 |
| Web Crawl | 抓取网页 | URL | 网页内容 |
| TODO | 任务管理 | 任务描述 | TODO列表 |
| MCP | 第三方集成 | 工具名+参数 | 工具结果 |
| Structure | 分析项目 | 文件列表 | 结构摘要 |
| Search | 代码搜索 | 搜索意图 | 匹配结果 |
| Command | 命令生成 | 任务描述 | Shell命令 |

## 最佳实践

1. **选择合适的工具**：根据任务性质选择最合适的工具
2. **组合使用**：善用工具链和工具编排
3. **结果验证**：始终验证工具的输出
4. **错误处理**：优雅地处理工具失败
5. **性能优化**：避免不必要的工具调用

---

**文档创建时间**：2025-10-17
**相关文件**：
- `autocoder/rag/tools/*.py`
- `autocoder/common/mcp_tools/*.py`
- `autocoder/utils/*.py`
